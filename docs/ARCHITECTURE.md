# Архитектура Randarc-Astra

EN kept: названия технологий/стандартов (API, HTTP, SSE, Tauri, React, JSON) оставлены на английском как общепринятые.

## Картина в целом

Astra устроена как локальная станция:

- Десктоп‑интерфейс (Tauri/React) — основное окно и overlay.
- Локальный API (FastAPI) — планы, задачи, события, память.
- Автопилот (Tauri) — скриншоты, мышь, клавиатура, быстрый цикл.
- Навыки (Python) — логика исполнения и LLM‑контур.

## Автопилотный цикл

Основной режим — Computer Vision Loop:

1. Снимок экрана (downscale + JPEG).
2. Запрос к модели с целью и контекстом.
3. Ответ в виде JSON‑протокола действий.
4. Выполнение действий мышью/клавиатурой.
5. Запись событий и повтор цикла.

## Overlay

Отдельное прозрачное окно поверх экрана показывает:

- цель и план,
- текущий шаг и короткое объяснение,
- последние действия,
- статус (running/paused/needs_user/done),
- кнопки Stop/Pause/Confirm/Reject.

## Событийное ядро

Источник истины — `Run` + `Events`.
Интерфейс строит состояние из потока событий и/или снимка:
`GET /api/v1/runs/{run_id}/snapshot`.

## Подтверждение (Confirm Gate)

Опасные действия требуют подтверждения:

- создание/отправка/удаление,
- платежи и переводы,
- изменения аккаунтов,
- системные команды.

Подтверждения пишутся в БД и события.

## Десктоп‑мост

API общается с десктоп‑частью через локальный bridge на 127.0.0.1.
Основные пути:

- `POST /autopilot/capture`
- `POST /autopilot/act`
- `POST /computer/execute`
- `POST /shell/execute`
